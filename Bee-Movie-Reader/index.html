<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bee Movie Script - Accessible Reader</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#fef9e7;--fg:#2c2c2c;--accent:#f5c518;--accent2:#3d2b00;
  --panel:#1a1a1a;--panel-fg:#e8e8e8;--panel-border:#333;
  --honey1:#f5c518;--honey2:#e8a317;--honey3:#c68a12;
}
body{
  font-family:'Georgia','Times New Roman',serif;
  background:var(--panel);
  color:var(--panel-fg);
  min-height:100vh;
  display:grid;
  grid-template-columns:340px 1fr;
  grid-template-rows:auto 1fr;
}
@media(max-width:900px){
  body{grid-template-columns:1fr;grid-template-rows:auto auto 1fr}
}

/* ===== HEADER ===== */
header{
  grid-column:1/-1;
  background:linear-gradient(135deg,#1a1200 0%,#3d2b00 40%,#1a1200 100%);
  padding:20px 28px;
  display:flex;
  align-items:center;
  gap:20px;
  border-bottom:3px solid var(--honey1);
  position:relative;
  overflow:hidden;
}
header::before{
  content:'';position:absolute;top:0;left:0;right:0;bottom:0;
  background:repeating-linear-gradient(90deg,transparent,transparent 18px,rgba(245,197,24,0.03) 18px,rgba(245,197,24,0.03) 20px);
  pointer-events:none;
}
.bee-icon{font-size:2.8rem;filter:drop-shadow(0 0 8px rgba(245,197,24,0.5));animation:beeFloat 3s ease-in-out infinite}
@keyframes beeFloat{0%,100%{transform:translateY(0) rotate(0deg)}25%{transform:translateY(-6px) rotate(3deg)}75%{transform:translateY(4px) rotate(-2deg)}}
header h1{
  font-size:1.8rem;font-weight:700;
  background:linear-gradient(90deg,#f5c518,#ffe066,#f5c518);
  background-size:200% 100%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  animation:shimmer 4s linear infinite;
  letter-spacing:0.05em;
}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
header p{color:#c9a84c;font-size:0.9rem;font-style:italic}

/* ===== SIDEBAR ===== */
.sidebar{
  background:var(--panel);
  border-right:1px solid var(--panel-border);
  padding:16px;
  overflow-y:auto;
  max-height:calc(100vh - 80px);
}
@media(max-width:900px){.sidebar{max-height:50vh;border-right:none;border-bottom:1px solid var(--panel-border)}}
.section{margin-bottom:20px}
.section-title{
  font-size:0.8rem;font-weight:700;text-transform:uppercase;letter-spacing:0.15em;
  color:var(--honey1);margin-bottom:10px;
  padding-bottom:6px;border-bottom:1px solid #2a2a2a;
  display:flex;align-items:center;gap:8px;
}
.section-title .icon{font-size:1rem}

/* Controls */
.control-row{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.control-row label{font-size:0.8rem;color:#aaa;min-width:80px}
.control-row input[type="color"]{
  width:42px;height:30px;border:2px solid #444;border-radius:6px;cursor:pointer;
  background:transparent;padding:0;
}
.control-row input[type="color"]::-webkit-color-swatch-wrapper{padding:2px}
.control-row input[type="color"]::-webkit-color-swatch{border-radius:3px;border:none}
.control-row input[type="range"]{
  flex:1;height:4px;-webkit-appearance:none;background:#333;border-radius:2px;outline:none;
}
.control-row input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;width:16px;height:16px;
  background:linear-gradient(135deg,var(--honey1),var(--honey3));
  border-radius:50%;cursor:pointer;
}
.control-row .val{font-family:'Consolas',monospace;font-size:0.75rem;color:#888;min-width:36px;text-align:right}
.hex-input{
  background:#222;border:1px solid #444;color:#ddd;padding:4px 8px;border-radius:4px;
  font-family:'Consolas',monospace;font-size:0.8rem;width:80px;
}

/* Presets */
.presets-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.preset-btn{
  padding:8px 6px;border-radius:6px;border:2px solid transparent;
  cursor:pointer;font-size:0.7rem;font-weight:600;text-align:center;
  transition:all 0.2s;position:relative;overflow:hidden;
}
.preset-btn:hover{transform:translateY(-1px);border-color:var(--honey1)}
.preset-btn.active{border-color:var(--honey1);box-shadow:0 0 10px rgba(245,197,24,0.3)}
.preset-btn span{position:relative;z-index:1;text-shadow:0 1px 2px rgba(0,0,0,0.5)}

/* Vision sim */
.vision-btns{display:flex;flex-wrap:wrap;gap:5px}
.vision-btn{
  padding:5px 10px;border-radius:999px;border:1px solid #444;
  background:#222;color:#aaa;font-size:0.72rem;cursor:pointer;transition:all 0.2s;
}
.vision-btn:hover{border-color:#666;color:#fff}
.vision-btn.active{background:var(--honey1);color:#000;border-color:var(--honey1);font-weight:700}

/* Status cards */
.status-card{
  background:#111;border:1px solid #2a2a2a;border-radius:8px;padding:12px;margin-bottom:8px;
}
.status-card .label{font-size:0.72rem;color:#777;text-transform:uppercase;letter-spacing:0.1em}
.status-card .value{font-size:1.4rem;font-weight:800;margin:4px 0;font-family:'Consolas',monospace}
.status-card .sub{font-size:0.75rem;color:#888}

.badge{
  display:inline-block;padding:3px 10px;border-radius:999px;font-size:0.7rem;font-weight:700;margin:2px;
}
.badge.pass{background:#1a3a1a;color:#4f4;border:1px solid #2a5a2a}
.badge.fail{background:#3a1a1a;color:#f66;border:1px solid #5a2a2a}
.badges-row{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px}

/* ===== READER ===== */
.reader{
  padding:32px;
  overflow-y:auto;
  max-height:calc(100vh - 80px);
  position:relative;
}
@media(max-width:900px){.reader{max-height:none;padding:20px}}
.reader-inner{
  max-width:720px;
  margin:0 auto;
  padding:40px;
  border-radius:12px;
  transition:background 0.3s,color 0.3s,font-size 0.3s;
  line-height:1.8;
  box-shadow:0 4px 30px rgba(0,0,0,0.3);
  position:relative;
}

/* Honeycomb watermark */
.reader-inner::before{
  content:'';position:absolute;top:0;left:0;right:0;bottom:0;
  opacity:0.03;pointer-events:none;border-radius:12px;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='56' height='100'%3E%3Cpath d='M28 66L0 50V16L28 0l28 16v34L28 66zM28 100L0 84V50l28-16 28 16v34L28 100z' fill='%23f5c518' fill-opacity='1'/%3E%3C/svg%3E");
  background-size:40px;
}

.script-title{
  font-size:1.6em;font-weight:700;text-align:center;margin-bottom:8px;
  border-bottom:2px solid currentColor;padding-bottom:12px;
}
.script-meta{text-align:center;font-style:italic;opacity:0.7;margin-bottom:24px;font-size:0.9em}
.scene-heading{font-weight:700;text-transform:uppercase;margin:24px 0 8px;letter-spacing:0.05em}
.character{font-weight:700;text-transform:uppercase;margin-top:16px;margin-bottom:2px}
.dialogue{margin-left:24px;margin-bottom:12px}
.parenthetical{margin-left:24px;font-style:italic;opacity:0.7;font-size:0.9em}
.action{margin:12px 0;font-style:italic;opacity:0.85}

/* Sim overlay */
.sim-overlay{
  position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;
  border-radius:12px;mix-blend-mode:normal;z-index:2;
}

/* Toast */
.toast{
  position:fixed;bottom:24px;right:24px;
  background:var(--honey1);color:#000;padding:10px 20px;border-radius:999px;
  font-weight:700;font-size:0.85rem;z-index:9999;opacity:0;
  transform:translateY(20px);transition:all 0.3s;pointer-events:none;
}
.toast.show{opacity:1;transform:translateY(0)}
</style>
</head>
<body>

<header>
  <div class="bee-icon">&#x1F41D;</div>
  <div>
    <h1>Bee Movie Script Reader</h1>
    <p>"According to all known laws of aviation..."</p>
  </div>
</header>

<aside class="sidebar">
  <!-- COLORS -->
  <div class="section">
    <div class="section-title"><span class="icon">&#x1F3A8;</span> Color Controls</div>
    <div class="control-row">
      <label>Background</label>
      <input type="color" id="bgColor" value="#fef9e7">
      <input type="text" class="hex-input" id="bgHex" value="#fef9e7">
    </div>
    <div class="control-row">
      <label>Text Color</label>
      <input type="color" id="fgColor" value="#2c2c2c">
      <input type="text" class="hex-input" id="fgHex" value="#2c2c2c">
    </div>
  </div>

  <!-- TEXT SIZE -->
  <div class="section">
    <div class="section-title"><span class="icon">&#x1F520;</span> Text Size</div>
    <div class="control-row">
      <label>Size</label>
      <input type="range" id="textSize" min="12" max="32" value="16">
      <span class="val" id="textSizeVal">16px</span>
    </div>
  </div>

  <!-- PRESETS -->
  <div class="section">
    <div class="section-title"><span class="icon">&#x1F36F;</span> Bee-Themed Presets</div>
    <div class="presets-grid" id="presetsGrid"></div>
  </div>

  <!-- CONTRAST / LUMINOSITY -->
  <div class="section">
    <div class="section-title"><span class="icon">&#x1F4CA;</span> Contrast &amp; Luminosity</div>
    <div class="status-card">
      <div class="label">Contrast Ratio</div>
      <div class="value" id="contrastValue">--</div>
      <div class="sub" id="contrastSub"></div>
    </div>
    <div class="status-card">
      <div class="label">Background Luminosity</div>
      <div class="value" id="bgLumValue">--</div>
    </div>
    <div class="status-card">
      <div class="label">Text Luminosity</div>
      <div class="value" id="fgLumValue">--</div>
    </div>
  </div>

  <!-- WCAG -->
  <div class="section">
    <div class="section-title"><span class="icon">&#x2705;</span> WCAG Compliance</div>
    <div class="badges-row" id="wcagBadges"></div>
  </div>

  <!-- VISION SIM -->
  <div class="section">
    <div class="section-title"><span class="icon">&#x1F441;</span> Vision Simulation</div>
    <div class="vision-btns" id="visionBtns">
      <button class="vision-btn active" data-type="normal">Normal</button>
      <button class="vision-btn" data-type="protanopia">Protanopia</button>
      <button class="vision-btn" data-type="deuteranopia">Deuteranopia</button>
      <button class="vision-btn" data-type="tritanopia">Tritanopia</button>
      <button class="vision-btn" data-type="achromatopsia">Achromatopsia</button>
    </div>
  </div>
</aside>

<main class="reader" id="readerMain">
  <div class="reader-inner" id="readerInner">
    <div class="sim-overlay" id="simOverlay"></div>
    <div id="scriptContent"></div>
  </div>
</main>

<div class="toast" id="toast"></div>

<script>
// ============================================
// Bee Movie Script Data
// ============================================
const SCRIPT = `NARRATOR: According to all known laws of aviation, there is no way a bee should be able to fly. Its wings are too small to get its fat little body off the ground. The bee, of course, flies anyway because bees don't care what humans think is impossible.

SCENE: INT. BENSON HOUSE - BEDROOM - DAY

Yellow, black. Yellow, black. Yellow, black. Yellow, black. Ooh, black and yellow! Let's shake it up a little.

BARRY: (stretching in bed) Yellow, black. Yellow, black. Yellow, black. Yellow, black. Ooh, black and yellow! Let's shake it up a little.

JANET BENSON: Barry! Breakfast is ready!

BARRY: Coming! Hang on a second.

(Barry uses his antennae to style his hair, looks in the mirror)

BARRY: I can't believe I'm graduating. I never thought I'd be here. I feel like I'm just getting started.

(He looks at a wall of awards and photos)

BARRY: Three days grade school, three days high school. Those were awkward.

SCENE: INT. BENSON HOUSE - KITCHEN - CONTINUOUS

JANET BENSON: Barry, come on! You'll be late!

BARRY: I'm coming!

MARTIN BENSON: Here's the graduate. We're very proud of you, son. A perfect report card, all B's.

JANET BENSON: Very proud.

BARRY: Ma! I got a thing going here.

(Barry adjusts his sweater)

MARTIN BENSON: You got lint on your fuzz.

BARRY: Ow! That's me!

JANET BENSON: Wave to us! We'll be in row 118,000.

BARRY: Bye!

(Barry flies out the door)

SCENE: EXT. BEE NEIGHBORHOOD - CONTINUOUS

(Barry flies through the hive, passing other bees)

BARRY: I heard the new grass is really green.

ADAM FLAYMAN: Barry!

BARRY: Adam!

ADAM: Hey, can you believe this is happening?

BARRY: I can't. I'll pick you up.

(Barry picks up Adam, they fly together)

ADAM: Sounds stunning. Let me see the results.

BARRY: Looking sharp. Use the stairs. Your father paid good money for those.

SCENE: INT. HONEX INDUSTRIES - DAY

(They arrive at a massive honey factory)

ANNOUNCER: Welcome to Honex, a division of Honesco and a part of the Hexagon Group.

BARRY: This is it.

ADAM: Wow.

BARRY: Wow.

(They walk through the factory floor)

ADAM: We know that you, as a bee, have worked your whole life to get to the point where you can work for your whole life. Honey begins when our valiant Pollen Jocks bring the nectar to the hive. Our top-secret formula is automatically color-corrected, scent-adjusted and bubble-contoured into this soothing sweet syrup with its distinctive golden glow you know as... Honey!

BARRY: That girl was hot.

ADAM: She's my cousin!

BARRY: She is?

ADAM: Yes, we're all cousins.

BARRY: Right. You're right.

ADAM: At Honex, we constantly strive to improve every aspect of bee existence. These bees are stress-testing a new helmet technology.

BARRY: What do you think he makes?

ADAM: Not enough.

BARRY: Here we go. "Bee Movie."

(They watch bees working in various departments)

SCENE: INT. GRADUATION CEREMONY - DAY

DEAN BUZZWELL: Welcome, New Hive City graduating class of 9:15. That concludes our ceremonies. And begins your career at Honex Industries!

BARRY: Are we going to pick our job today?

ADAM: I heard it's just orientation.

(Barry and Adam explore different departments)

BARRY: Heads up! Here we go.

BEE WORKER: Keep your hands and antennas inside the tram at all times.

ADAM: Wonder what it'll be like?

BARRY: A little scary.

(The tram takes them past the honey processing floor)

BARRY: Welcome to Honex, a division of Honesco and a part of the Hexagon Group.

SCENE: EXT. FLOWER FIELD - DAY

(The Pollen Jocks prepare for a mission)

BUZZ: Alright, we got the sunflower patch in quadrant nine.

LOU LO DUCA: Copy that. What about you, Barry? You ever think about being a Pollen Jock?

BARRY: A Pollen Jock?! Aren't those the guys that go outside the hive?

BUZZ: Yeah, those are some crazy-brave bees.

BARRY: I've never been outside the hive before.

ADAM: Oh, Barry. You wouldn't last an hour out there with all those... giant scary things.

BARRY: I guess I could try it. What's the worst that could happen?

(Barry looks out toward the vast world beyond the hive)

BARRY: You know, I think I'm going to go outside.

ADAM: Barry, no!

BARRY: It's time I see what's out there.

SCENE: EXT. THE OUTSIDE WORLD - DAY

(Barry flies out of the hive for the first time)

BARRY: Wow. This is amazing. I'm flying! I'm actually flying with the Pollen Jocks!

BUZZ: Stay close to the group, kid.

BARRY: I feel so alive!

(They fly over a beautiful park)

BARRY: Is that a daisy? Oh, that's gorgeous. This is incredible.

(Suddenly a tennis ball flies past)

BARRY: Whoa! What was that?!

BUZZ: That's a tennis ball, rookie. Stay focused.

(Barry lands on a flower and starts collecting pollen)

BARRY: I'm doing it! I'm actually collecting pollen! Wait till Adam hears about this.

SCENE: EXT. VANESSA'S APARTMENT BALCONY - DAY

(Barry gets separated from the group and lands on a balcony)

BARRY: Where am I? What is this place?

(He sees Vanessa through the window)

BARRY: That's a human. A real live human.

(Vanessa opens the window)

VANESSA: Oh my. A bee. Don't move.

BARRY: (frozen) I'm not moving.

VANESSA: (picks up a magazine, about to swat) Hold on.

KEN: (entering) Kill it! Kill it!

VANESSA: Wait. Look at its little face.

(She puts down the magazine)

VANESSA: It's kind of cute.

BARRY: (whispering) She's not going to kill me. She thinks I'm cute.

KEN: Vanessa, it's a bug!

VANESSA: It's a bee, Ken. There's a difference. Bees are important.

(Ken rolls his eyes and leaves)

BARRY: (still frozen) She saved my life. I owe her everything.

SCENE: INT. VANESSA'S APARTMENT - LATER

(Barry flies inside and lands on the counter)

VANESSA: (startled) Oh! You're still here?

BARRY: Yeah. I mean... bzzzz.

VANESSA: (laughing) Are you... talking to me?

BARRY: (deciding to break bee law) Yes. Yes I am.

VANESSA: (shocked) YOU CAN TALK?!

BARRY: Look, I know this is weird. I'm as surprised as you are.

VANESSA: How is this possible?

BARRY: I don't know. Bees have always been able to talk. We just... never talked to humans before.

VANESSA: This is... this is incredible. I'm Vanessa.

BARRY: I'm Barry. Barry B. Benson.

VANESSA: Nice to meet you, Barry.

BARRY: Nice to meet you too, Vanessa. Thanks for not squishing me, by the way.

VANESSA: (laughing) You're welcome. So... do all bees talk?

BARRY: Yes, but you're the first human I've ever spoken to. This is kind of a big deal for me.

VANESSA: For me too. I've never had a conversation with an insect before.

BARRY: Technically, bees are flying insects of the order Hymenoptera, closely related to wasps and ants.

VANESSA: That's... very specific.

BARRY: We take classification seriously.

SCENE: INT. VANESSA'S APARTMENT - EVENING

(Barry and Vanessa are having dinner, a tiny plate set up for Barry)

VANESSA: So what's it like being a bee?

BARRY: It's... honestly? I'm kind of going through something right now. I just graduated, and I'm supposed to pick one job and do it for the rest of my life.

VANESSA: That sounds rough.

BARRY: Right?! It's like, I'm a bee, I should be happy making honey. But I want more, you know?

VANESSA: I totally understand. I went through the same thing when I was picking a career.

BARRY: What do you do?

VANESSA: I'm a florist.

BARRY: (gasps) A florist?! You work with flowers?! That's like... you're basically in the bee business!

VANESSA: (laughing) I guess I am!

BARRY: We should totally collaborate. Bee-human flower partnership.

VANESSA: I'd like that.

SCENE: INT. SUPERMARKET - DAY

(Barry discovers honey being sold)

BARRY: (horrified) What... what is this? They're selling our honey? In a STORE?

(He picks up a jar)

BARRY: "Honey Farms." "Bee Happy Honey." "Honey Bear." How could they do this?! This is OUR honey! The bees MADE this!

(He checks multiple brands)

BARRY: They have entire AISLES of it! This is exploitation! This is... this is stealing!

VANESSA: Barry, calm down.

BARRY: Calm down?! They're taking what we make and selling it! That's not right, Vanessa. Something has to be done.

VANESSA: What are you going to do?

BARRY: I'm going to sue the human race.

VANESSA: ...What?

BARRY: I'm going to sue the ENTIRE human race for stealing our honey.

VANESSA: Barry, you can't sue all of humanity.

BARRY: Watch me.

SCENE: INT. COURTROOM - DAY

JUDGE: The case of the bees versus the human race. This is... unprecedented.

LAYTON T. MONTGOMERY: Your Honor, this is absurd. A bee cannot sue humanity.

BARRY: (standing on a tiny podium) With all due respect, Your Honor, I'm not just any bee. And this isn't just about honey. It's about respect. It's about recognizing that bees contribute to this world, and our work has value.

(Murmurs in the courtroom)

BARRY: Every jar of honey on every shelf in every store represents the life's work of bees. And we never gave permission for any of it.

JUDGE: The bee makes a compelling argument.

LAYTON: This is ridiculous!

BARRY: What's ridiculous is that bees pollinate over 80% of the world's flowering plants, and in return, our honey is harvested without our consent. We're not asking for much. We just want what's ours.

(The jury looks moved)

JUDGE: I'll allow the case to proceed.

BARRY: (pumping his tiny fist) Yes!

SCENE: INT. COURTROOM - LATER (VERDICT)

JUDGE: Has the jury reached a verdict?

JURY FOREPERSON: We have, Your Honor. We find in favor of... the bees.

(The courtroom erupts)

BARRY: We did it! We won!

(Bees everywhere celebrate)

SCENE: EXT. VARIOUS LOCATIONS - MONTAGE

NARRATOR: And so the bees won. All honey was ordered returned. Honey production stopped. But something unexpected happened...

(Flowers start wilting. Fields go bare. The ecosystem begins to collapse)

BARRY: (looking at the dying flowers) What's happening?

VANESSA: Barry... the bees stopped working. Without honey production, there's no pollination. Without pollination...

BARRY: The flowers die.

VANESSA: Everything dies, Barry. Fruits, vegetables, the entire food chain.

BARRY: (horrified) What have I done?

SCENE: INT. VANESSA'S APARTMENT - NIGHT

BARRY: I have to fix this. I have to get the bees back to work.

VANESSA: How?

BARRY: I need to remind them why we do what we do. It's not just about honey. It's about life. The flowers need us. The world needs us.

VANESSA: The Tournament of Roses Parade is tomorrow in Pasadena. It has the last remaining flowers. If we can get those flowers to the bees...

BARRY: That's it! We fly the flowers back! Vanessa, you're a genius!

SCENE: EXT. AIRPLANE / PASADENA - DAY

(Barry and Vanessa commandeer a float plane full of flowers)

BARRY: This is insane!

VANESSA: You're telling me!

(They fly the plane toward New York)

BARRY: Come on, bees! Remember what you were born to do! Pollinate!

(One by one, bees emerge and begin pollinating the flowers)

ADAM: Barry?! What are you doing?!

BARRY: Saving the world, Adam! Are you in?

ADAM: (smiling) I'm in.

(Thousands of bees join in, pollinating the flowers as the plane lands safely)

SCENE: EXT. CENTRAL PARK - DAY

(The world is green again. Flowers bloom everywhere)

BARRY: We did it.

VANESSA: You did it, Barry.

BARRY: No. WE did it. Humans and bees. Together.

VANESSA: So what happens now?

BARRY: Now? I think I'll start a little law firm. Bees have a lot of rights that need protecting. Plus, I hear there's a great florist nearby who might need a business partner.

VANESSA: (smiling) I think she'd like that.

BARRY: You know, they say bees shouldn't be able to fly. But you know what? We fly anyway. Because it's not about what you can't do. It's about what you will do.

VANESSA: That's beautiful, Barry.

BARRY: Thanks. I've been working on it.

(They look out over the park as bees fly happily among the flowers)

NARRATOR: And so Barry found his purpose â€” not just as a bee, not just as a lawyer, but as a bridge between two worlds. The honey flowed again, the flowers bloomed, and for the first time in history, bees and humans worked side by side. As for Barry and Vanessa? Well, that's a different story. But one thing was certain: life was sweet.

THE END`;

// ============================================
// Utilities
// ============================================
function hexToRgb(h){h=h.replace('#','');if(h.length===3)h=h.split('').map(c=>c+c).join('');const n=parseInt(h,16);return[(n>>16)&255,(n>>8)&255,n&255]}
function rgbToHex(r,g,b){return '#'+[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('')}
function luminance(r,g,b){const a=[r,g,b].map(v=>{v/=255;return v<=0.03928?v/12.92:Math.pow((v+0.055)/1.055,2.4)});return 0.2126*a[0]+0.7152*a[1]+0.0722*a[2]}
function contrastRatio(rgb1,rgb2){const l1=luminance(...rgb1)+0.05,l2=luminance(...rgb2)+0.05;return l1>l2?l1/l2:l2/l1}
function clamp(v,lo,hi){return Math.max(lo,Math.min(hi,v))}

// Color blindness simulation matrices
const cbMatrices={
  protanopia:[[0.567,0.433,0],[0.558,0.442,0],[0,0.242,0.758]],
  deuteranopia:[[0.625,0.375,0],[0.7,0.3,0],[0,0.3,0.7]],
  tritanopia:[[0.95,0.05,0],[0,0.433,0.567],[0,0.475,0.525]],
  achromatopsia:[[0.299,0.587,0.114],[0.299,0.587,0.114],[0.299,0.587,0.114]]
};
function simulateCB(rgb,type){
  const m=cbMatrices[type];if(!m)return rgb;
  return[
    clamp(Math.round(m[0][0]*rgb[0]+m[0][1]*rgb[1]+m[0][2]*rgb[2]),0,255),
    clamp(Math.round(m[1][0]*rgb[0]+m[1][1]*rgb[1]+m[1][2]*rgb[2]),0,255),
    clamp(Math.round(m[2][0]*rgb[0]+m[2][1]*rgb[1]+m[2][2]*rgb[2]),0,255)
  ];
}

function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}

// ============================================
// Presets
// ============================================
const PRESETS=[
  {name:"Honeycomb",bg:"#fef9e7",fg:"#2c2c2c",desc:"Classic honey"},
  {name:"Royal Jelly",bg:"#1a0a2e",fg:"#e8d5f5",desc:"Purple royalty"},
  {name:"Beeswax",bg:"#f5e6c8",fg:"#3d2b00",desc:"Warm wax"},
  {name:"Night Hive",bg:"#0a0a0a",fg:"#f5c518",desc:"Dark & gold"},
  {name:"Pollen",bg:"#fffde7",fg:"#33691e",desc:"Spring green"},
  {name:"Stinger",bg:"#1a1a1a",fg:"#ff6f00",desc:"Bold orange"},
  {name:"Flower Field",bg:"#fce4ec",fg:"#4a148c",desc:"Pink garden"},
  {name:"Bee Suit",bg:"#ffffff",fg:"#000000",desc:"High contrast"},
  {name:"Amber",bg:"#3e2723",fg:"#ffcc80",desc:"Warm amber"},
  {name:"Honey Dark",bg:"#1b1200",fg:"#ffd54f",desc:"Deep honey"},
];

// ============================================
// Script Parser
// ============================================
function parseScript(raw){
  const lines=raw.split('\n');
  let html='';
  html+='<div class="script-title">BEE MOVIE</div>';
  html+='<div class="script-meta">Written by Jerry Seinfeld &amp; Spike Feresten &amp; Barry Marder &amp; Andy Robin</div>';

  for(const line of lines){
    const trimmed=line.trim();
    if(!trimmed){html+='<br>';continue}

    if(trimmed.startsWith('SCENE:')){
      html+=`<div class="scene-heading">${trimmed}</div>`;
    } else if(trimmed.startsWith('NARRATOR:')){
      html+=`<div class="action">${trimmed}</div>`;
    } else if(trimmed.startsWith('(')&&trimmed.endsWith(')')){
      html+=`<div class="parenthetical">${trimmed}</div>`;
    } else {
      const charMatch=trimmed.match(/^([A-Z][A-Z\s.]+?):\s*(\(.*?\))?\s*(.*)/);
      if(charMatch){
        const char=charMatch[1];
        const paren=charMatch[2]||'';
        const dialogue=charMatch[3]||'';
        html+=`<div class="character">${char}${paren?' <span class="parenthetical" style="display:inline">${paren}</span>':''}</div>`;
        if(dialogue) html+=`<div class="dialogue">${dialogue}</div>`;
      } else {
        html+=`<div class="dialogue">${trimmed}</div>`;
      }
    }
  }
  return html;
}

// ============================================
// State & DOM
// ============================================
let currentBg=[254,249,231];
let currentFg=[44,44,44];
let currentVision='normal';

const bgColorEl=document.getElementById('bgColor');
const fgColorEl=document.getElementById('fgColor');
const bgHexEl=document.getElementById('bgHex');
const fgHexEl=document.getElementById('fgHex');
const textSizeEl=document.getElementById('textSize');
const textSizeValEl=document.getElementById('textSizeVal');
const readerInner=document.getElementById('readerInner');
const readerMain=document.getElementById('readerMain');
const scriptContent=document.getElementById('scriptContent');

// Render script
scriptContent.innerHTML=parseScript(SCRIPT);

// ============================================
// Update Functions
// ============================================
function updateDisplay(){
  let bg=currentBg,fg=currentFg;

  if(currentVision!=='normal'){
    bg=simulateCB(currentBg,currentVision);
    fg=simulateCB(currentFg,currentVision);
  }

  readerInner.style.background=rgbToHex(...bg);
  readerInner.style.color=rgbToHex(...fg);

  // Also set a subtle shadow on the reader area
  readerMain.style.background=`rgb(${Math.max(0,bg[0]-30)},${Math.max(0,bg[1]-30)},${Math.max(0,bg[2]-30)})`;

  updateStats();
}

function updateStats(){
  let bg=currentBg,fg=currentFg;
  if(currentVision!=='normal'){
    bg=simulateCB(currentBg,currentVision);
    fg=simulateCB(currentFg,currentVision);
  }

  const bgLum=luminance(...bg);
  const fgLum=luminance(...fg);
  const ratio=contrastRatio(bg,fg);

  document.getElementById('contrastValue').textContent=ratio.toFixed(2)+' : 1';
  document.getElementById('contrastSub').textContent=ratio>=7?'Excellent':ratio>=4.5?'Good':ratio>=3?'Acceptable':'Poor';
  document.getElementById('contrastValue').style.color=ratio>=4.5?'#4f4':ratio>=3?'#ff0':'#f66';

  document.getElementById('bgLumValue').textContent=bgLum.toFixed(4);
  document.getElementById('bgLumValue').style.color=bgLum>0.5?'#ffd':'#aaa';
  document.getElementById('fgLumValue').textContent=fgLum.toFixed(4);
  document.getElementById('fgLumValue').style.color=fgLum>0.5?'#ffd':'#aaa';

  // WCAG badges
  const badges=[
    ['AA Normal (4.5:1)',ratio>=4.5],
    ['AA Large (3:1)',ratio>=3],
    ['AAA Normal (7:1)',ratio>=7],
    ['AAA Large (4.5:1)',ratio>=4.5],
  ];
  document.getElementById('wcagBadges').innerHTML=badges.map(([l,p])=>
    `<span class="badge ${p?'pass':'fail'}">${l}: ${p?'PASS':'FAIL'}</span>`
  ).join('');
}

function setColors(bg,fg){
  currentBg=bg;currentFg=fg;
  bgColorEl.value=rgbToHex(...bg);
  fgColorEl.value=rgbToHex(...fg);
  bgHexEl.value=rgbToHex(...bg);
  fgHexEl.value=rgbToHex(...fg);
  updateDisplay();
}

// ============================================
// Event Listeners
// ============================================

// Color pickers
bgColorEl.addEventListener('input',e=>{currentBg=hexToRgb(e.target.value);bgHexEl.value=e.target.value;updateDisplay()});
fgColorEl.addEventListener('input',e=>{currentFg=hexToRgb(e.target.value);fgHexEl.value=e.target.value;updateDisplay()});
bgHexEl.addEventListener('change',e=>{try{currentBg=hexToRgb(e.target.value);bgColorEl.value=e.target.value;updateDisplay()}catch(ex){}});
fgHexEl.addEventListener('change',e=>{try{currentFg=hexToRgb(e.target.value);fgColorEl.value=e.target.value;updateDisplay()}catch(ex){}});

// Text size
textSizeEl.addEventListener('input',e=>{
  const sz=e.target.value;
  readerInner.style.fontSize=sz+'px';
  textSizeValEl.textContent=sz+'px';
});

// Presets
const presetsGrid=document.getElementById('presetsGrid');
PRESETS.forEach((p,i)=>{
  const btn=document.createElement('button');
  btn.className='preset-btn';
  btn.style.background=p.bg;btn.style.color=p.fg;
  btn.innerHTML=`<span>${p.name}</span>`;
  btn.title=p.desc;
  btn.addEventListener('click',()=>{
    setColors(hexToRgb(p.bg),hexToRgb(p.fg));
    presetsGrid.querySelectorAll('.preset-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    showToast('Applied: '+p.name);
  });
  presetsGrid.appendChild(btn);
});

// Vision simulation
document.querySelectorAll('.vision-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.vision-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentVision=btn.dataset.type;
    updateDisplay();
    if(currentVision!=='normal') showToast('Simulating: '+btn.textContent);
  });
});

// ============================================
// Init
// ============================================
updateDisplay();
</script>
</body>
</html>
