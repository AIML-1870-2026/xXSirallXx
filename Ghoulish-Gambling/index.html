<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ghoulish Gambling â€” Blackjack</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --ink:#06060f;
  --deep:#0d0d1a;
  --panel:#14141f;
  --felt:#0f2912;
  --felt-hi:#183d1b;
  --gold:#c8a84a;
  --gold2:#f0d480;
  --purple:#7b2fff;
  --pur2:#3d0d99;
  --orange:#ff6b1a;
  --green:#19d45a;
  --red:#ff2040;
  --bone:#ede8d8;
  --muted:#5a5a72;
  --shadow:rgba(0,0,0,.85);
}
html,body{height:100%;overflow:hidden;background:var(--ink)}
body{
  font-family:'Cinzel',Georgia,serif;
  color:var(--bone);
  display:flex;flex-direction:column;
  min-height:100vh;
  user-select:none;
}

/* â”€â”€â”€ SCREENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.screen{
  position:absolute;inset:0;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  transition:opacity .45s ease;
}
.screen.gone{opacity:0;pointer-events:none}

/* â”€â”€â”€ TITLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#titleScreen{
  background:
    radial-gradient(ellipse 70% 55% at 50% 38%,#2a0060 0%,transparent 65%),
    radial-gradient(ellipse 100% 100% at 50% 80%,#1a1a08 0%,var(--ink) 60%);
  gap:0;
}
.gf{
  position:absolute;pointer-events:none;
  animation:gDrift 10s ease-in-out infinite;
  opacity:.1;
}
.gf:nth-child(1){font-size:3rem;top:8%;left:7%;animation-delay:0s}
.gf:nth-child(2){font-size:2rem;top:15%;right:10%;animation-delay:2.5s}
.gf:nth-child(3){font-size:2.5rem;bottom:20%;left:12%;animation-delay:5s}
.gf:nth-child(4){font-size:1.6rem;bottom:28%;right:7%;animation-delay:1.5s}
.gf:nth-child(5){font-size:1.2rem;top:50%;left:4%;animation-delay:4s}
.gf:nth-child(6){font-size:2rem;top:40%;right:4%;animation-delay:3s}
@keyframes gDrift{
  0%,100%{transform:translateY(0) rotate(-4deg)}
  50%{transform:translateY(-30px) rotate(4deg)}
}
.t-skull{
  font-size:5.5rem;margin-bottom:16px;
  animation:skulPulse 2.5s ease-in-out infinite;
  filter:drop-shadow(0 0 24px var(--purple));
}
@keyframes skulPulse{
  0%,100%{filter:drop-shadow(0 0 24px var(--purple));transform:scale(1)}
  50%{filter:drop-shadow(0 0 48px var(--orange));transform:scale(1.07)}
}
.t-main{
  font-family:'Cinzel Decorative',serif;
  font-size:clamp(1.8rem,5.5vw,4.2rem);font-weight:700;
  background:linear-gradient(135deg,var(--orange) 0%,var(--gold) 40%,var(--gold2) 60%,var(--orange) 100%);
  background-size:200%;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  animation:shim 4s linear infinite;
  letter-spacing:.04em;text-align:center;margin-bottom:8px;
}
@keyframes shim{0%{background-position:200% 0}100%{background-position:-200% 0}}
.t-sub{
  font-size:clamp(.75rem,1.8vw,.95rem);
  color:var(--purple);letter-spacing:.35em;text-transform:uppercase;
  margin-bottom:36px;text-align:center;
}
.t-divider{
  width:160px;height:1px;margin:0 auto 36px;
  background:linear-gradient(90deg,transparent,var(--gold),transparent);
}
.btn-enter{
  padding:16px 60px;
  font-family:'Cinzel',serif;font-size:1.1rem;font-weight:700;
  background:linear-gradient(135deg,var(--pur2),var(--purple));
  color:#fff;border:2px solid var(--purple);border-radius:999px;
  cursor:pointer;letter-spacing:.18em;text-transform:uppercase;
  box-shadow:0 0 40px rgba(123,47,255,.4),0 6px 24px var(--shadow);
  transition:all .22s;
}
.btn-enter:hover{
  transform:translateY(-3px) scale(1.04);
  box-shadow:0 0 64px rgba(123,47,255,.6),0 10px 32px var(--shadow);
}
.t-keys{
  margin-top:20px;font-size:.68rem;color:var(--muted);
  font-family:system-ui,monospace;letter-spacing:.06em;
}

/* â”€â”€â”€ GAME SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#gameScreen{
  flex-direction:column;justify-content:stretch;
  position:absolute;inset:0;padding:0;
}

/* â”€â”€ HUD â”€â”€ */
.hud{
  width:100%;
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 24px;
  background:rgba(0,0,0,.75);
  border-bottom:1px solid rgba(201,168,74,.18);
  flex-shrink:0;
}
.hud-logo{
  font-family:'Cinzel Decorative',serif;
  font-size:.85rem;color:var(--gold);letter-spacing:.1em;white-space:nowrap;
}
.hud-stats{display:flex;gap:24px;align-items:center}
.hud-item{display:flex;flex-direction:column;align-items:center;gap:2px}
.hud-cap{font-size:.5rem;text-transform:uppercase;letter-spacing:.15em;color:var(--muted);font-family:system-ui}
.hud-num{font-size:.95rem;font-weight:700;line-height:1}
.hud-num.gold{color:var(--gold)}
.hud-num.grn{color:var(--green)}
.hud-strikes{display:flex;gap:5px;align-items:center}
.sk{width:11px;height:11px;border-radius:50%;background:#222;transition:all .35s}
.sk.lit{background:var(--red);box-shadow:0 0 8px var(--red)}

/* â”€â”€ TABLE WRAPPER â”€â”€ */
.table-wrap{
  flex:1;display:flex;align-items:center;justify-content:center;
  padding:14px 20px 10px;
  background:
    radial-gradient(ellipse 60% 80% at 50% 50%,rgba(10,30,10,.6) 0%,transparent 70%),
    var(--ink);
  position:relative;overflow:hidden;
}
/* atmospheric candle glow corners */
.table-wrap::before{
  content:'';position:absolute;
  width:200px;height:200px;border-radius:50%;
  background:radial-gradient(ellipse,rgba(255,120,30,.07) 0%,transparent 70%);
  top:-60px;left:-60px;animation:flicker 4s ease-in-out infinite;
}
.table-wrap::after{
  content:'';position:absolute;
  width:200px;height:200px;border-radius:50%;
  background:radial-gradient(ellipse,rgba(255,120,30,.07) 0%,transparent 70%);
  top:-60px;right:-60px;animation:flicker 4s ease-in-out infinite 1.5s;
}
@keyframes flicker{
  0%,100%{opacity:1;transform:scale(1)}
  33%{opacity:.7;transform:scale(.95)}
  66%{opacity:.9;transform:scale(1.03)}
}

/* â”€â”€ THE TABLE â”€â”€ */
.table{
  width:100%;max-width:960px;height:100%;max-height:520px;
  border-radius:200px;
  position:relative;overflow:hidden;
  display:flex;flex-direction:column;
  /* Layered felt */
  background:
    radial-gradient(ellipse 60% 45% at 50% 35%,var(--felt-hi) 0%,var(--felt) 50%,#0a1e0a 100%);
  /* Gold rim */
  border:3px solid var(--gold);
  box-shadow:
    0 0 0 1px rgba(201,168,74,.15),
    0 0 0 6px rgba(201,168,74,.06),
    0 24px 80px rgba(0,0,0,.9),
    inset 0 2px 0 rgba(255,255,255,.05),
    inset 0 0 60px rgba(0,0,0,.4);
}
/* Oval inset guide line */
.table::before{
  content:'';position:absolute;
  inset:18px 30px;
  border:1px solid rgba(201,168,74,.12);
  border-radius:160px;
  pointer-events:none;z-index:0;
}
/* Suit watermarks */
.table::after{
  content:'â™  â™¥ â™¦ â™£';
  position:absolute;bottom:14px;right:24px;
  font-size:.75rem;color:rgba(201,168,74,.08);
  letter-spacing:.5em;pointer-events:none;z-index:0;
}

/* â”€â”€ UPPER HALF: NPCs + Dealer â”€â”€ */
.upper{
  flex:1;display:flex;align-items:center;justify-content:space-around;
  padding:20px 24px 8px;position:relative;z-index:1;
}

/* NPC zones */
.npc-zone{
  display:flex;flex-direction:column;align-items:center;gap:6px;
  position:relative;min-width:110px;
}
.npc-avatar{font-size:1.8rem;opacity:.65;line-height:1}
.npc-name{
  font-size:.58rem;letter-spacing:.15em;text-transform:uppercase;
  color:var(--muted);font-family:system-ui,sans-serif;
}
.npc-react{
  position:absolute;top:-26px;
  font-size:1.3rem;
  animation:rPop 1.6s ease-out forwards;
  pointer-events:none;z-index:10;
}
@keyframes rPop{
  0%{opacity:1;transform:translateY(0) scale(1)}
  50%{transform:translateY(-12px) scale(1.4)}
  100%{opacity:0;transform:translateY(-28px) scale(.8)}
}

/* Dealer zone */
.dealer-zone{
  display:flex;flex-direction:column;align-items:center;gap:8px;
  flex:0 0 auto;
}
.dealer-cap{
  font-size:.58rem;letter-spacing:.2em;text-transform:uppercase;
  color:var(--muted);font-family:system-ui,sans-serif;
}
.dealer-sprite{
  font-size:3rem;line-height:1;
  animation:dIdle 3s ease-in-out infinite;
  filter:drop-shadow(0 4px 16px rgba(255,107,26,.3));
}
@keyframes dIdle{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-6px)}
}
.dealer-sprite.charging{
  animation:dCharge .75s ease-in forwards!important;
  filter:drop-shadow(0 0 32px var(--red))!important;
}
@keyframes dCharge{
  0%{transform:translateX(0) scale(1)}
  18%{transform:translateX(-16px) scale(1.12)}
  55%{transform:translateX(40vw) scale(3)}
  100%{transform:translateX(50vw) scale(5);opacity:0}
}
.dealer-total{
  font-size:.82rem;color:var(--orange);font-weight:700;
  min-height:1.1em;font-family:system-ui,sans-serif;letter-spacing:.04em;
}

/* â”€â”€ DIVIDER â”€â”€ */
.felt-sep{
  width:calc(100% - 80px);height:1px;margin:0 auto;
  background:linear-gradient(90deg,transparent,rgba(201,168,74,.18),transparent);
  position:relative;z-index:1;flex-shrink:0;
}

/* â”€â”€ LOWER HALF: Player â”€â”€ */
.lower{
  flex:1;display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:10px;
  padding:8px 24px 18px;position:relative;z-index:1;
}
.player-cap{
  font-size:.58rem;letter-spacing:.2em;text-transform:uppercase;
  color:var(--muted);font-family:system-ui,sans-serif;
}
.player-total{
  font-size:1.2rem;font-weight:700;
  font-family:system-ui,sans-serif;
  min-height:1.5em;transition:color .3s;letter-spacing:.03em;
  color:var(--green);
}
.player-total.bust{color:var(--red)}

/* â”€â”€ SWAP BANNER â”€â”€ */
.swap-banner{
  position:absolute;top:12px;left:50%;transform:translateX(-50%);
  background:linear-gradient(135deg,var(--pur2),var(--purple));
  color:#fff;padding:5px 20px;border-radius:999px;
  font-size:.68rem;font-weight:700;letter-spacing:.1em;white-space:nowrap;
  box-shadow:0 0 20px rgba(123,47,255,.55);
  display:none;z-index:10;
  animation:bPulse 1.3s ease-in-out infinite;
}
@keyframes bPulse{0%,100%{opacity:1}50%{opacity:.6}}
.swap-banner.on{display:block}

/* â”€â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hand{
  display:flex;gap:8px;flex-wrap:wrap;
  justify-content:center;align-items:flex-end;
  min-height:112px;
}
/* REAL playing card */
.card{
  width:72px;height:104px;border-radius:8px;flex-shrink:0;
  display:grid;
  grid-template-rows:auto 1fr auto;
  padding:5px 5px;
  position:relative;
  transition:transform .2s;
  animation:cDeal .3s cubic-bezier(.34,1.56,.64,1) both;
}
.card:hover:not(.cback){transform:translateY(-8px)}
@keyframes cDeal{
  from{transform:translateY(-50px) rotate(-8deg) scale(.75);opacity:0}
  to{transform:none;opacity:1}
}
.card.cred{
  background:linear-gradient(160deg,#fff 0%,#fdf8f8 100%);
  color:#c80028;
  border:1px solid #ddd;
  box-shadow:0 4px 14px rgba(0,0,0,.7),inset 0 1px 0 rgba(255,255,255,.8);
}
.card.cblk{
  background:linear-gradient(160deg,#fff 0%,#f8f8fd 100%);
  color:#0a0a20;
  border:1px solid #ddd;
  box-shadow:0 4px 14px rgba(0,0,0,.7),inset 0 1px 0 rgba(255,255,255,.8);
}
.card.cback{
  background:linear-gradient(145deg,#200050,#3e0088,#200050);
  border:2px solid var(--purple);
  box-shadow:0 4px 16px rgba(0,0,0,.8),0 0 12px rgba(123,47,255,.2);
  cursor:pointer;overflow:hidden;
}
/* Gothic pattern on card back */
.card.cback::before{
  content:'';position:absolute;inset:4px;
  background:
    repeating-linear-gradient(45deg,rgba(123,47,255,.1) 0,rgba(123,47,255,.1) 1px,transparent 1px,transparent 8px),
    repeating-linear-gradient(-45deg,rgba(123,47,255,.1) 0,rgba(123,47,255,.1) 1px,transparent 1px,transparent 8px);
  border-radius:5px;
}
.card.cback::after{
  content:'ğŸ‘';position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-size:1.6rem;opacity:0;transition:opacity .2s;z-index:1;
}
.card.cback:hover{border-color:var(--orange);box-shadow:0 0 20px rgba(255,107,26,.45),0 4px 16px rgba(0,0,0,.8)}
.card.cback:hover::after{opacity:1}

/* Card corner indices */
.ci{display:flex;flex-direction:column;align-items:flex-start;line-height:1.1}
.ci.flip{align-items:flex-end;transform:rotate(180deg)}
.ci-v{font-size:.85rem;font-weight:900;letter-spacing:-.02em}
.ci-s{font-size:.65rem;line-height:.9}
/* Center suit */
.cc{
  display:flex;align-items:center;justify-content:center;
  font-size:1.7rem;line-height:1;
}

/* NPC small cards */
.ncard{width:48px;height:70px;border-radius:6px;padding:3px;animation:cDeal .28s cubic-bezier(.34,1.56,.64,1) both}
.ncard .ci-v{font-size:.68rem}
.ncard .ci-s{font-size:.52rem}
.ncard .cc{font-size:1.1rem}
.ncard.cback::after{font-size:1.1rem}

/* Split active glow */
.splitActive{outline:2px solid var(--green);border-radius:12px;padding:5px;box-shadow:0 0 18px rgba(25,212,90,.3)}

/* â”€â”€â”€ RESULT OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#resultOverlay{
  position:absolute;inset:0;z-index:70;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:rgba(0,0,0,.75);backdrop-filter:blur(6px);
  opacity:0;pointer-events:none;transition:opacity .35s;
  border-radius:197px;
}
#resultOverlay.show{opacity:1;pointer-events:all}
.rbox{
  background:var(--panel);border-radius:22px;
  padding:28px 54px;text-align:center;
  display:flex;flex-direction:column;align-items:center;gap:10px;
  min-width:250px;
  animation:rPop2 .42s cubic-bezier(.34,1.56,.64,1);
  box-shadow:0 20px 70px rgba(0,0,0,.8);
}
@keyframes rPop2{from{transform:scale(.5) translateY(30px);opacity:0}to{transform:none;opacity:1}}
.rbox.win{border:2px solid var(--gold)}
.rbox.lose{border:2px solid var(--red)}
.rbox.push{border:2px solid #444}
.rbox.bj{border:2px solid var(--orange)}
.r-ico{font-size:2.8rem;line-height:1}
.r-lbl{font-size:1.55rem;font-weight:900;line-height:1}
.r-lbl.win{color:var(--gold)}
.r-lbl.lose{color:var(--red)}
.r-lbl.push{color:var(--bone)}
.r-lbl.bj{color:var(--orange);font-size:2rem}
.r-chips{font-size:.82rem;color:var(--muted);font-family:system-ui,sans-serif;margin-top:2px}
.r-chips .pos{color:var(--green);font-weight:700}
.r-chips .neg{color:var(--red);font-weight:700}

/* â”€â”€â”€ PEEK BUBBLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#peekBubble{
  position:absolute;top:42%;left:50%;transform:translate(-50%,-50%);
  background:rgba(5,0,18,.97);border:2px solid var(--purple);border-radius:14px;
  padding:13px 26px;text-align:center;z-index:60;
  font-family:system-ui,sans-serif;font-size:.88rem;
  box-shadow:0 0 28px rgba(123,47,255,.5);
  opacity:0;pointer-events:none;transition:opacity .25s;
}
#peekBubble.show{opacity:1}
#peekBubble strong{color:var(--purple);font-size:1.1rem}

/* â”€â”€â”€ CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.controls{
  width:100%;
  background:linear-gradient(180deg,rgba(0,0,0,.5) 0%,rgba(0,0,0,.8) 100%);
  border-top:1px solid rgba(201,168,74,.14);
  padding:14px 24px 16px;
  flex-shrink:0;
  display:flex;flex-direction:column;align-items:center;gap:0;
}

/* Bet phase */
.bet-phase{
  display:flex;flex-direction:column;align-items:center;gap:12px;width:100%;
}
.bet-row1{display:flex;align-items:center;gap:20px;flex-wrap:wrap;justify-content:center}
.bet-info{text-align:center}
.bet-cap{font-size:.6rem;text-transform:uppercase;letter-spacing:.15em;color:var(--muted);font-family:system-ui}
.bet-num{
  font-size:2.2rem;font-weight:900;color:var(--gold);
  font-family:'Cinzel',serif;
  text-shadow:0 0 20px rgba(200,168,74,.4);
  line-height:1;
}
.chips-wrap{display:flex;gap:9px;flex-wrap:wrap;justify-content:center}
.chip{
  width:46px;height:46px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:.68rem;font-weight:700;cursor:pointer;
  transition:transform .15s,box-shadow .15s;
  font-family:system-ui,sans-serif;
  border:3px dashed;
  position:relative;
}
.chip::after{content:'';position:absolute;inset:3px;border-radius:50%;border:1px dashed;opacity:.4}
.chip:hover{transform:translateY(-3px) scale(1.15)}
.chip:active{transform:scale(.95)}
.chip.c10{background:#18182a;border-color:#888;color:#ccc}
.chip.c10::after{border-color:#888}
.chip.c25{background:#0d2200;border-color:#4caf50;color:#70da74}
.chip.c25::after{border-color:#4caf50}
.chip.c50{background:#001840;border-color:#5090ff;color:#88aaff}
.chip.c50::after{border-color:#5090ff}
.chip.c100{background:#280010;border-color:#e91e63;color:#ff6699}
.chip.c100::after{border-color:#e91e63}
.chip.c500{background:#281600;border-color:var(--gold);color:var(--gold)}
.chip.c500::after{border-color:var(--gold)}

.bet-row2{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:center}
.btn-sm{
  padding:8px 20px;background:transparent;
  border:1px solid var(--muted);border-radius:8px;
  color:var(--muted);cursor:pointer;
  font-size:.78rem;font-family:'Cinzel',serif;
  transition:all .2s;
}
.btn-sm:hover{border-color:var(--red);color:var(--red)}
.btn-max{border-color:var(--gold);color:var(--gold)}
.btn-max:hover{border-color:var(--gold2);color:var(--gold2);background:rgba(200,168,74,.08)}
.btn-allin{border-color:var(--red);color:var(--red);font-weight:700;letter-spacing:.06em}
.btn-allin:hover{border-color:#ff6080;color:#ff6080;background:rgba(255,32,64,.12);transform:scale(1.05);box-shadow:0 0 18px rgba(255,32,64,.35)}
.btn-deal{
  padding:13px 52px;
  font-family:'Cinzel',serif;font-size:1rem;font-weight:700;
  background:linear-gradient(135deg,var(--pur2),var(--purple));
  color:#fff;border:2px solid var(--purple);border-radius:12px;
  cursor:pointer;letter-spacing:.14em;text-transform:uppercase;
  box-shadow:0 4px 22px rgba(123,47,255,.38);
  transition:all .2s;
}
.btn-deal:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(123,47,255,.55)}
.btn-deal:disabled{opacity:.35;cursor:not-allowed;transform:none}

/* Action phase */
.action-phase{
  display:flex;flex-direction:column;align-items:center;gap:10px;width:100%;
}
.action-binfo{
  font-size:.7rem;color:var(--muted);
  font-family:system-ui,sans-serif;text-align:center;
}
.action-binfo em{color:var(--gold);font-style:normal;font-weight:700;font-size:.88rem}
.action-btns{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}

/* Big action buttons */
.abtn{
  display:flex;flex-direction:column;align-items:center;gap:4px;
  padding:11px 20px;border-radius:12px;border:none;cursor:pointer;
  font-family:'Cinzel',serif;font-weight:700;font-size:.88rem;
  letter-spacing:.05em;transition:all .16s;
  min-width:78px;
  position:relative;overflow:hidden;
}
.abtn::before{
  content:'';position:absolute;inset:0;
  background:rgba(255,255,255,0);transition:background .15s;
}
.abtn:hover:not(:disabled)::before{background:rgba(255,255,255,.08)}
.abtn:hover:not(:disabled){transform:translateY(-4px);box-shadow:0 8px 22px rgba(0,0,0,.55)}
.abtn:active:not(:disabled){transform:translateY(0)}
.abtn:disabled{opacity:.25;cursor:not-allowed}
.kh{font-size:.5rem;opacity:.4;font-family:monospace;letter-spacing:0}
.abtn-hit   {background:linear-gradient(160deg,#112811,#1a4a1a);color:#aaff99;border:1px solid rgba(25,212,90,.25);box-shadow:0 3px 12px rgba(0,0,0,.5)}
.abtn-stand {background:linear-gradient(160deg,#380a0a,#5a1414);color:#ffaaaa;border:1px solid rgba(255,32,64,.25);box-shadow:0 3px 12px rgba(0,0,0,.5)}
.abtn-double{background:linear-gradient(160deg,#2e2000,#503800);color:#ffcc66;border:1px solid rgba(200,168,74,.25);box-shadow:0 3px 12px rgba(0,0,0,.5)}
.abtn-split {background:linear-gradient(160deg,#0e0e38,#1a1a5a);color:#aaaaff;border:1px solid rgba(100,100,255,.25);box-shadow:0 3px 12px rgba(0,0,0,.5)}
.abtn-peek  {background:linear-gradient(160deg,#1e0038,#38006a);color:#cc88ff;border:1px solid rgba(123,47,255,.3);box-shadow:0 3px 12px rgba(0,0,0,.5)}

/* Dealer playing */
.dealer-phase{
  display:flex;align-items:center;gap:14px;
  justify-content:center;color:var(--muted);
  font-family:system-ui,sans-serif;font-size:.88rem;
  padding:10px 0;
}
.spinner{
  width:22px;height:22px;
  border:2px solid rgba(255,255,255,.1);
  border-top-color:var(--orange);
  border-radius:50%;
  animation:spin .75s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* Next round */
.next-phase{padding:8px 0;text-align:center}
.btn-next{
  padding:13px 54px;border-radius:12px;
  border:2px solid var(--green);background:transparent;
  color:var(--green);cursor:pointer;
  font-family:'Cinzel',serif;font-weight:700;font-size:1rem;
  letter-spacing:.14em;transition:all .2s;
  box-shadow:0 0 20px rgba(25,212,90,.15);
}
.btn-next:hover{
  background:rgba(25,212,90,.1);
  box-shadow:0 0 36px rgba(25,212,90,.35);
  transform:translateY(-2px);
}

/* â”€â”€â”€ INSURANCE MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#insModal{
  position:absolute;inset:0;z-index:80;
  display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,.8);backdrop-filter:blur(8px);
  opacity:0;pointer-events:none;transition:opacity .28s;
  border-radius:197px;
}
#insModal.show{opacity:1;pointer-events:all}
.ins-box{
  background:var(--panel);
  border:2px solid var(--gold);border-radius:22px;
  padding:30px 42px;text-align:center;max-width:340px;
  box-shadow:0 20px 70px rgba(0,0,0,.85);
  animation:rPop2 .35s cubic-bezier(.34,1.56,.64,1);
}
.ins-box h3{font-size:1.2rem;color:var(--gold);margin-bottom:10px}
.ins-box p{font-size:.82rem;color:var(--muted);font-family:system-ui;line-height:1.6;margin-bottom:18px}
.ins-btns{display:flex;gap:12px;justify-content:center}
.btn-ins-y{
  padding:10px 26px;
  background:linear-gradient(135deg,#0c3000,#1a5500);
  color:#88ff88;border:1px solid #4caf50;border-radius:9px;
  cursor:pointer;font-family:'Cinzel',serif;font-weight:700;
  transition:all .2s;
}
.btn-ins-y:hover{background:linear-gradient(135deg,#1a5500,#2a8000);transform:translateY(-1px)}
.btn-ins-n{
  padding:10px 26px;background:transparent;
  color:var(--muted);border:1px solid var(--muted);border-radius:9px;
  cursor:pointer;font-family:'Cinzel',serif;font-weight:700;
  transition:all .2s;
}
.btn-ins-n:hover{border-color:var(--red);color:var(--red)}

/* â”€â”€â”€ SOUL SWAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#soulSwap{
  position:fixed;inset:0;z-index:200;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  pointer-events:none;opacity:0;background:transparent;
  transition:opacity .4s,background .4s;
}
#soulSwap.on{opacity:1;pointer-events:all;background:rgba(0,0,0,.94)}
.ss-orb{
  font-size:5rem;
  animation:ssOrb 1.6s ease-in-out infinite alternate;
}
@keyframes ssOrb{
  from{transform:scale(1) rotate(-6deg);filter:drop-shadow(0 0 22px var(--purple))}
  to{transform:scale(1.15) rotate(6deg);filter:drop-shadow(0 0 55px var(--orange))}
}
.ss-title{
  font-size:clamp(2rem,5.5vw,3.5rem);font-weight:900;
  color:var(--purple);margin-top:18px;letter-spacing:.1em;
  animation:ssGlow .7s ease-in-out infinite alternate;
}
@keyframes ssGlow{
  from{text-shadow:0 0 24px var(--purple),0 0 48px var(--purple)}
  to{text-shadow:0 0 48px var(--orange),0 0 96px var(--purple)}
}
.ss-sub{
  font-size:.95rem;color:var(--bone);opacity:.7;
  margin-top:14px;text-align:center;
  font-family:system-ui;max-width:300px;
}

/* â”€â”€â”€ CRACKED SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#crack{
  position:fixed;inset:0;z-index:300;
  pointer-events:none;opacity:0;transition:opacity .12s;
}
#crack.on{opacity:1}
#crack svg{width:100%;height:100%;position:absolute;inset:0}
.cv{
  position:absolute;inset:0;
  background:radial-gradient(ellipse at center,transparent 20%,rgba(200,0,40,.55) 100%);
}
.cw{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  font-family:'Cinzel',serif;font-size:clamp(1rem,3.5vw,2rem);font-weight:900;
  color:var(--red);text-align:center;text-shadow:0 0 24px var(--red);
  animation:wFlash .13s linear infinite;
}
@keyframes wFlash{0%,100%{opacity:1}50%{opacity:.1}}

/* â”€â”€â”€ GAME OVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#gameOverScreen{
  background:
    radial-gradient(ellipse at 50% 38%,#1e0000 0%,var(--ink) 65%);
  gap:14px;
}
.go-ghost{font-size:5rem;animation:goFl 2.5s ease-in-out infinite}
@keyframes goFl{0%,100%{transform:translateY(0)}50%{transform:translateY(-24px)}}
.go-h{font-size:2.5rem;font-weight:900;color:var(--red);letter-spacing:.06em}
.go-sub{font-size:.95rem;color:var(--muted);font-family:system-ui}
.go-chips{font-size:1.3rem;color:var(--gold)}
.go-buttons{display:flex;flex-direction:column;align-items:center;gap:14px;margin-top:4px}
.btn-soul{
  padding:14px 40px;
  font-family:'Cinzel',serif;font-size:1rem;font-weight:700;
  background:linear-gradient(135deg,#3d0000,#7a0000);
  color:#ff4060;border:2px solid #cc0030;border-radius:999px;
  cursor:pointer;letter-spacing:.14em;text-transform:uppercase;
  box-shadow:0 0 30px rgba(200,0,40,.5),0 6px 20px var(--shadow);
  transition:all .25s;
}
.btn-soul:hover{transform:translateY(-2px) scale(1.04);box-shadow:0 0 50px rgba(255,0,60,.7),0 8px 28px var(--shadow)}

/* â”€â”€â”€ SOUL DEAL OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#soulDeal{
  background:
    radial-gradient(ellipse 80% 60% at 50% 40%,#3d0050 0%,#1a0010 55%,var(--ink) 100%);
  z-index:500;flex-direction:column;gap:22px;
}
.sd-skull{font-size:6rem;animation:sdPulse 1.1s ease-in-out infinite}
@keyframes sdPulse{
  0%,100%{transform:scale(1);filter:drop-shadow(0 0 28px var(--red))}
  50%{transform:scale(1.18);filter:drop-shadow(0 0 72px #ff0040)}
}
.sd-title{
  font-family:'Cinzel Decorative',serif;
  font-size:clamp(1.5rem,4vw,2.6rem);font-weight:700;
  color:var(--red);letter-spacing:.06em;text-align:center;
  text-shadow:0 0 30px var(--red),0 0 70px rgba(255,0,64,.4);
  animation:sdFlick .18s linear infinite alternate;
}
@keyframes sdFlick{0%{opacity:1}100%{opacity:.88}}
.sd-flavor{font-size:1rem;color:var(--bone);opacity:.75;font-family:system-ui;text-align:center;max-width:380px;line-height:1.6}
.sd-chips{font-size:2.6rem;font-weight:700;color:var(--green);text-shadow:0 0 24px var(--green)}
.sd-warning{font-size:.78rem;color:var(--red);opacity:.6;font-family:system-ui;letter-spacing:.06em;text-transform:uppercase}

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-height:660px){
  .table{max-height:440px;border-radius:160px}
  .table::before{border-radius:130px}
  #resultOverlay,#insModal{border-radius:157px}
  .dealer-sprite{font-size:2.3rem}
  .card{width:60px;height:88px}
  .card .cc{font-size:1.4rem}
  .ncard{width:40px;height:60px}
  .controls{padding:10px 20px 12px;gap:0}
  .bet-num{font-size:1.8rem}
  .chip{width:40px;height:40px}
}
@media(max-width:520px){
  .card{width:60px;height:88px}
  .card .cc{font-size:1.4rem}
  .abtn{min-width:62px;padding:9px 12px;font-size:.8rem}
  .chip{width:40px;height:40px}
  .table{border-radius:140px}
  #resultOverlay,#insModal{border-radius:137px}
  .table::before{border-radius:110px}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TITLE SCREEN
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="titleScreen">
  <span class="gf">ğŸ‘»</span>
  <span class="gf">ğŸ’€</span>
  <span class="gf">ğŸ¦‡</span>
  <span class="gf">ğŸ‘</span>
  <span class="gf">ğŸ•·</span>
  <span class="gf">ğŸ•¯</span>
  <div class="t-skull">ğŸ’€</div>
  <div class="t-main">GHOULISH GAMBLING</div>
  <div class="t-sub">Blackjack with a Spooky Twist</div>
  <div class="t-divider"></div>
  <button class="btn-enter" onclick="startGame()">ğŸƒ &nbsp;Deal Me In</button>
  <div class="t-keys">[H] Hit &nbsp;Â·&nbsp; [S] Stand &nbsp;Â·&nbsp; [D] Double &nbsp;Â·&nbsp; [P] Peek &nbsp;Â·&nbsp; [Enter] Next Round</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GAME SCREEN
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen gone" id="gameScreen" style="flex-direction:column;justify-content:stretch">

  <!-- HUD -->
  <div class="hud">
    <div class="hud-logo">ğŸ’€ Ghoulish Gambling</div>
    <div class="hud-stats">
      <div class="hud-item">
        <div class="hud-cap">Chips</div>
        <div class="hud-num gold" id="hudChips">1000</div>
      </div>
      <div class="hud-item">
        <div class="hud-cap">Bet</div>
        <div class="hud-num grn" id="hudBet">â€”</div>
      </div>
      <div class="hud-item">
        <div class="hud-cap">Round</div>
        <div class="hud-num" id="hudRound">1</div>
      </div>
      <div class="hud-item">
        <div class="hud-cap">Strikes</div>
        <div class="hud-strikes" id="hudStrikes">
          <div class="sk"></div><div class="sk"></div><div class="sk"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- TABLE WRAPPER -->
  <div class="table-wrap">
    <div class="table" id="table">

      <div class="swap-banner" id="swapBanner">âš ï¸ SOUL SWAPPED â€” YOU ARE THE DEALER</div>

      <!-- Insurance modal (inside table so it stays within the oval) -->
      <div id="insModal">
        <div class="ins-box">
          <h3>ğŸƒ Insurance?</h3>
          <p>Dealer shows an Ace â€” buy insurance for half your bet to guard against dealer Blackjack?</p>
          <div class="ins-btns">
            <button class="btn-ins-y" onclick="takeInsurance(true)">Take Insurance</button>
            <button class="btn-ins-n" onclick="takeInsurance(false)">No Thanks</button>
          </div>
        </div>
      </div>

      <!-- Peek bubble -->
      <div id="peekBubble"></div>

      <!-- â”€â”€ UPPER HALF â”€â”€ -->
      <div class="upper">
        <div class="npc-zone" id="npc1">
          <div class="npc-avatar">ğŸ‘»</div>
          <div class="hand" id="npc1Hand"></div>
          <div class="npc-name">Spectre</div>
        </div>

        <div class="dealer-zone">
          <div class="dealer-cap">Dealer</div>
          <div class="dealer-sprite" id="dealerSpr">ğŸ’€</div>
          <div class="hand" id="dealerHand"></div>
          <div class="dealer-total" id="dealerTotal"></div>
        </div>

        <div class="npc-zone" id="npc2">
          <div class="npc-avatar">ğŸ¦‡</div>
          <div class="hand" id="npc2Hand"></div>
          <div class="npc-name">Batilda</div>
        </div>
      </div>

      <div class="felt-sep"></div>

      <!-- â”€â”€ LOWER HALF â”€â”€ -->
      <div class="lower">
        <div class="player-cap" id="playerCap">Your Hand</div>
        <div class="hand" id="playerHand"></div>
        <div class="player-total" id="playerTotal"></div>
      </div>

      <!-- Result overlay -->
      <div id="resultOverlay">
        <div class="rbox" id="rbox">
          <div class="r-ico" id="rIco">ğŸƒ</div>
          <div class="r-lbl" id="rLbl">WIN</div>
          <div class="r-chips" id="rChips"></div>
        </div>
      </div>

    </div><!-- /table -->
  </div><!-- /table-wrap -->

  <!-- CONTROLS -->
  <div class="controls">

    <!-- BET -->
    <div class="bet-phase" id="betCtrl">
      <div class="bet-row1">
        <div class="bet-info">
          <div class="bet-cap">Current Bet</div>
          <div class="bet-num" id="betNum">$50</div>
        </div>
        <div class="chips-wrap">
          <div class="chip c10"  onclick="addChip(10)">10</div>
          <div class="chip c25"  onclick="addChip(25)">25</div>
          <div class="chip c50"  onclick="addChip(50)">50</div>
          <div class="chip c100" onclick="addChip(100)">100</div>
          <div class="chip c500" onclick="addChip(500)">500</div>
        </div>
      </div>
      <div class="bet-row2">
        <button class="btn-sm" onclick="clearBet()">Clear</button>
        <button class="btn-sm btn-max" onclick="maxBet()">Max Bet</button>
        <button class="btn-sm btn-allin" onclick="allIn()">ğŸ”¥ ALL IN</button>
        <button class="btn-deal" id="btnDeal" onclick="dealHand()">Deal â–¶</button>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="action-phase" id="actCtrl" style="display:none">
      <div class="action-binfo">Bet this round: <em id="actBet">$50</em></div>
      <div class="action-btns">
        <button class="abtn abtn-hit"    id="btnHit"    onclick="playerHit()">Hit<span class="kh">[H]</span></button>
        <button class="abtn abtn-stand"  id="btnStand"  onclick="playerStand()">Stand<span class="kh">[S]</span></button>
        <button class="abtn abtn-double" id="btnDouble" onclick="playerDouble()">Double<span class="kh">[D]</span></button>
        <button class="abtn abtn-split"  id="btnSplit"  onclick="playerSplit()">Split<span class="kh">[X]</span></button>
        <button class="abtn abtn-peek"   id="btnPeek"   onclick="attemptPeek()">ğŸ‘ Peek<span class="kh">[P]</span></button>
      </div>
    </div>

    <!-- DEALER PLAYING -->
    <div class="dealer-phase" id="dealCtrl" style="display:none">
      <div class="spinner"></div>
      <span>Dealer is playingâ€¦</span>
    </div>

    <!-- NEXT ROUND -->
    <div class="next-phase" id="nextCtrl" style="display:none">
      <button class="btn-next" onclick="nextRound()">Next Round â–¶</button>
    </div>

  </div><!-- /controls -->

</div><!-- /gameScreen -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GAME OVER
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen gone" id="gameOverScreen">
  <div class="go-ghost" id="goGhost">ğŸ‘»</div>
  <div class="go-h" id="goTitle">GAME OVER</div>
  <div class="go-sub" id="goSub">Your soul now belongs to the houseâ€¦</div>
  <div class="go-chips" id="goChips"></div>
  <div class="go-buttons">
    <button class="btn-soul" id="btnSellSoul" onclick="sellSoul()">ğŸ”¥ Sell Your Soul</button>
    <button class="btn-enter" onclick="resetGame()">â†º Play Again</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SOUL DEAL OVERLAY
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen gone" id="soulDeal">
  <div class="sd-skull">ğŸ’€</div>
  <div class="sd-title">DEAL WITH THE HOUSE</div>
  <div class="sd-flavor" id="sdFlavor"></div>
  <div class="sd-chips" id="sdChips"></div>
  <div class="sd-warning" id="sdWarning"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SOUL SWAP OVERLAY
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="soulSwap">
  <div class="ss-orb">ğŸŒ€</div>
  <div class="ss-title">SOUL SWAP!</div>
  <div class="ss-sub" id="soulSub"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CRACKED SCREEN
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="crack">
  <svg viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
    <g stroke="rgba(255,255,255,.85)" stroke-width="2.5" fill="none" stroke-linecap="round">
      <path d="M500,300 L418,178 L376,95"/>
      <path d="M500,300 L564,156 L604,76"/>
      <path d="M500,300 L655,218 L794,150"/>
      <path d="M500,300 L685,345 L835,382"/>
      <path d="M500,300 L625,425 L730,526"/>
      <path d="M500,300 L476,458 L456,566"/>
      <path d="M500,300 L355,405 L234,490"/>
      <path d="M500,300 L295,364 L150,346"/>
      <path d="M500,300 L336,244 L210,184"/>
      <path d="M418,178 L392,144 L344,122" stroke-width="1.5"/>
      <path d="M564,156 L596,134 L576,92"  stroke-width="1.5"/>
      <path d="M655,218 L706,196 L736,226" stroke-width="1.5"/>
      <path d="M476,458 L436,476 L398,454" stroke-width="1.5"/>
      <path d="M355,405 L325,436 L304,467" stroke-width="1.5"/>
      <path d="M336,244 L306,214 L276,244" stroke-width="1"/>
      <path d="M625,425 L665,445 L692,483" stroke-width="1"/>
    </g>
    <circle cx="500" cy="300" r="20" fill="rgba(255,255,255,.12)" stroke="rgba(255,255,255,.75)" stroke-width="2"/>
    <circle cx="500" cy="300" r="8"  fill="rgba(255,255,255,.4)"/>
  </svg>
  <div class="cv"></div>
  <div class="cw">âš ï¸ CAUGHT CHEATING âš ï¸<br><span style="font-size:.5em;letter-spacing:.12em">The skeleton is NOT pleased</span></div>
</div>

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CARD ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SUITS  = ['â™ ','â™¥','â™¦','â™£'];
const VALS   = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const RED    = new Set(['â™¥','â™¦']);

function deck()  { return SUITS.flatMap(s=>VALS.map(v=>({s,v}))); }
function shuf(a) { for(let i=a.length-1;i>0;i--){const j=0|Math.random()*(i+1);[a[i],a[j]]=[a[j],a[i]]}return a; }
function cv(v)   { return v==='A'?11:'KQJ'.includes(v)?10:+v; }
function tot(h)  {
  let t=0,a=0;
  for(const c of h){ if(c.hid)continue; t+=cv(c.v); if(c.v==='A')a++; }
  while(t>21&&a-->0)t-=10;
  return t;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEB AUDIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let AC;
function ac(){ return AC||(AC=new(window.AudioContext||window.webkitAudioContext)()); }
function tn(f,tp,d,v=.12){
  try{
    const c=ac(),o=c.createOscillator(),g=c.createGain();
    o.connect(g);g.connect(c.destination);
    o.type=tp;o.frequency.setValueAtTime(f,c.currentTime);
    g.gain.setValueAtTime(v,c.currentTime);
    g.gain.exponentialRampToValueAtTime(.001,c.currentTime+d);
    o.start();o.stop(c.currentTime+d);
  }catch(e){}
}
const sfxDeal=()=>{tn(440,'triangle',.09,.09);setTimeout(()=>tn(550,'triangle',.07,.07),55)};
const sfxWin =()=>[600,720,880,1080].forEach((f,i)=>setTimeout(()=>tn(f,'sine',.18,.13),i*80));
const sfxLose=()=>[270,230,190,145].forEach((f,i)=>setTimeout(()=>tn(f,'sawtooth',.2,.13),i*90));
const sfxSwap=()=>[200,320,450,320,200,450,680].forEach((f,i)=>setTimeout(()=>tn(f,'triangle',.28,.17),i*88));
const sfxCaught=()=>{for(let i=0;i<14;i++)setTimeout(()=>{tn(65+Math.random()*55,'sawtooth',.14,.28);tn(170+Math.random()*100,'square',.14,.22);},i*52)};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const G={
  pile:[],chips:1000,bet:50,round:1,
  strikes:0,maxS:3,
  phase:'bet',
  swapped:false,
  swapIn:rand36(),
  ins:0,insTaken:false,
  pH:[],dH:[],n1:[],n2:[],
  split:null,sIdx:0,
  soulSold:0,
};
function rand36(){ return Math.floor(Math.random()*4)+3; }
function draw(hid=false){
  if(G.pile.length<15) G.pile=shuf([...deck(),...deck()]);
  return {...G.pile.pop(),hid};
}
function initPile(){ G.pile=shuf([...deck(),...deck()]); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCard(c,sm=false){
  const sc=sm?' ncard':'';
  if(c.hid) return `<div class="card cback${sc}"></div>`;
  const cl=RED.has(c.s)?'cred':'cblk';
  return `<div class="card ${cl}${sc}" style="animation:cDeal .3s cubic-bezier(.34,1.56,.64,1) both">
    <div class="ci"><span class="ci-v">${c.v}</span><span class="ci-s">${c.s}</span></div>
    <div class="cc">${c.s}</div>
    <div class="ci flip"><span class="ci-v">${c.v}</span><span class="ci-s">${c.s}</span></div>
  </div>`;
}

function $$(id){ return document.getElementById(id); }

function updateUI(){
  // HUD
  $$('hudChips').textContent = G.chips;
  $$('hudBet').textContent   = G.phase==='bet'?'â€”':'$'+G.bet;
  $$('hudRound').textContent = G.round;
  document.querySelectorAll('.sk').forEach((d,i)=>d.classList.toggle('lit',i<G.strikes));

  // Dealer hand
  $$('dealerHand').innerHTML = G.dH.map(c=>renderCard(c)).join('');
  const vis=G.dH.filter(c=>!c.hid);
  $$('dealerTotal').textContent =
    (G.phase==='dealer'||G.phase==='over') ? 'Total: '+tot(G.dH)
    : vis.length ? 'Showing: '+tot(vis) : '';

  // Player hand(s)
  const hands=G.split||[G.pH];
  $$('playerHand').innerHTML=hands.map((h,i)=>{
    const cls=(G.split&&i===G.sIdx)?' splitActive':'';
    return `<div class="${cls}" style="display:flex;gap:8px">${h.map(c=>renderCard(c)).join('')}</div>`;
  }).join('');
  const cur  = G.split?G.split[G.sIdx]:G.pH;
  const pt   = tot(cur);
  const ptEl = $$('playerTotal');
  if(G.phase==='bet'){ ptEl.textContent=''; ptEl.className='player-total'; }
  else{ ptEl.textContent=pt>21?'ğŸ’€ BUST â€” '+pt:'Total: '+pt; ptEl.className='player-total'+(pt>21?' bust':''); }

  // NPCs â€” correct: use c not n1[0]
  $$('npc1Hand').innerHTML=G.n1.map(c=>G.phase==='over'?renderCard({...c,hid:false},true):'<div class="card cback ncard"></div>').join('');
  $$('npc2Hand').innerHTML=G.n2.map(c=>G.phase==='over'?renderCard({...c,hid:false},true):'<div class="card cback ncard"></div>').join('');

  // Swap
  $$('swapBanner').classList.toggle('on',G.swapped);
  $$('playerCap').textContent=G.swapped?'Your Hand (as Dealer)':'Your Hand';

  // Bet display
  $$('betNum').textContent='$'+G.bet;
  const deal=$$('btnDeal');
  if(deal) deal.disabled=G.chips<10||G.bet>G.chips||G.bet<10;

  // Action buttons
  if(G.phase==='player'){
    $$('actBet').textContent='$'+G.bet;
    const h=G.split?G.split[G.sIdx]:G.pH;
    const raw=G.pH;
    const canSplit=!G.split&&raw.length===2&&cv(raw[0].v)===cv(raw[1].v)&&G.chips>=G.bet;
    $$('btnSplit').disabled =!canSplit;
    $$('btnDouble').disabled=h.length!==2||G.chips<G.bet;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHASE SWITCHER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function phase(p){
  $$('betCtrl').style.display  = p==='bet'    ?'':'none';
  $$('actCtrl').style.display  = p==='player' ?'':'none';
  $$('dealCtrl').style.display = p==='dealer' ?'':'none';
  $$('nextCtrl').style.display = p==='over'   ?'':'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCREENS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGame(){
  initPile();
  $$('titleScreen').classList.add('gone');
  $$('gameScreen').classList.remove('gone');
  G.phase='bet'; phase('bet'); updateUI();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BETTING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addChip(v){ G.bet=Math.min(G.bet+v,G.chips,500); updateUI(); }
function clearBet(){ G.bet=Math.min(10,G.chips); updateUI(); }
function maxBet()  { G.bet=Math.min(500,G.chips); updateUI(); }
function allIn()   { G.bet=G.chips; updateUI(); sfxWin(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEAL â€” staggered animation
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function dealHand(){
  if(G.bet<10||G.bet>G.chips) return;
  G.chips-=G.bet;
  G.pH=[]; G.dH=[];
  G.n1=[draw(),draw()];
  G.n2=[draw(),draw()];
  G.split=null; G.sIdx=0;
  G.insTaken=false; G.ins=0;
  G.phase='player'; phase('player'); updateUI();

  // Staggered deal: P D P D(hidden)
  [
    ()=>{ G.pH.push(draw());     sfxDeal(); updateUI(); },
    ()=>{ G.dH.push(draw());      sfxDeal(); updateUI(); },
    ()=>{ G.pH.push(draw());      sfxDeal(); updateUI(); },
    ()=>{ G.dH.push(draw(true));  sfxDeal(); updateUI(); },
  ].forEach((fn,i)=>setTimeout(fn,i*190));

  setTimeout(afterDeal, 4*190+120);
}

function afterDeal(){
  npcReact();
  if(G.dH[0]?.v==='A') showIns();
  else checkBJ();
}

function checkBJ(){
  if(tot(G.pH)===21&&G.pH.length===2){
    G.dH.forEach(c=>c.hid=false); updateUI();
    endRound(tot(G.dH)===21?'push':'blackjack');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INSURANCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showIns(){ $$('insModal').classList.add('show'); }
function takeInsurance(yes){
  $$('insModal').classList.remove('show');
  if(yes){
    G.ins=Math.floor(G.bet/2);
    G.chips-=G.ins; G.insTaken=true; updateUI();
  }
  checkBJ();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAYER ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function playerHit(){
  if(G.phase!=='player') return;
  const h=G.split?G.split[G.sIdx]:G.pH;
  h.push(draw()); sfxDeal(); updateUI();
  const t=tot(h);
  if(t>21){
    if(G.split&&G.sIdx<G.split.length-1){ setTimeout(()=>{G.sIdx++;updateUI();},300); }
    else setTimeout(()=>endRound('bust'),460);
  } else if(t===21) playerStand();
}

function playerStand(){
  if(G.phase!=='player') return;
  if(G.split&&G.sIdx<G.split.length-1){ G.sIdx++;updateUI();return; }
  G.phase='dealer'; phase('dealer'); updateUI();
  setTimeout(dealerPlay,620);
}

function playerDouble(){
  if(G.phase!=='player'||G.chips<G.bet) return;
  G.chips-=G.bet; G.bet*=2; updateUI();
  const h=G.split?G.split[G.sIdx]:G.pH;
  h.push(draw()); sfxDeal(); updateUI();
  setTimeout(()=>{ if(tot(h)<=21)playerStand();else endRound('bust'); },440);
}

function playerSplit(){
  if(G.phase!=='player'||G.chips<G.bet||G.split) return;
  G.chips-=G.bet;
  G.split=[[G.pH[0],draw()],[G.pH[1],draw()]];
  G.sIdx=0; sfxDeal(); updateUI();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEALER PLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function dealerPlay(){
  G.dH.forEach(c=>c.hid=false); updateUI();
  (function step(){
    if(tot(G.dH)<17){
      setTimeout(()=>{G.dH.push(draw());sfxDeal();updateUI();step();},680);
    } else setTimeout(resolve,420);
  })();
}

function resolve(){
  const dt=tot(G.dH);
  const hands=G.split||[G.pH];
  let net=0,last='lose';
  hands.forEach(h=>{
    const pt=tot(h);
    const hb=G.bet/(G.split?G.split.length:1);
    if(pt>21){/* bust */}
    else if(dt>21||pt>dt){ net+=hb*2;last='win'; }
    else if(pt===dt)     { net+=hb;   last='push';}
    else                 {             last='lose';}
  });
  if(G.insTaken&&tot(G.dH)===21&&G.dH.length===2) net+=G.ins*3;
  G.chips+=net; updateUI();
  endRound(last);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// END ROUND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function endRound(r){
  G.phase='over'; phase('over');
  let ico,lbl,cls,delta=0;
  if(r==='blackjack'){
    G.chips+=Math.floor(G.bet*2.5);
    delta=Math.floor(G.bet*1.5);
    ico='ğŸƒ';lbl='BLACKJACK!';cls='bj';sfxWin();
  } else if(r==='win'){
    delta=G.bet; ico='ğŸ’°';lbl='YOU WIN!';cls='win';sfxWin();
  } else if(r==='push'){
    delta=0; ico='ğŸ¤';lbl='PUSH';cls='push';
  } else if(r==='bust'){
    delta=-G.bet; ico='ğŸ’€';lbl='BUST!';cls='lose';sfxLose();
  } else {
    delta=-G.bet; ico='â˜ ï¸';lbl='DEALER WINS';cls='lose';sfxLose();
  }
  updateUI();
  showResult(ico,lbl,cls,delta);

  // Soul swap countdown
  G.swapIn--;
  if(G.swapped) G.swapped=false;
  if(G.swapIn<=0){ G.swapIn=rand36(); setTimeout(doSoulSwap,2400); }

  // Game over
  if(G.chips<=0){
    setTimeout(()=>{
      hideResult();
      $$('gameScreen').classList.add('gone');
      const go=$$('gameOverScreen');
      go.classList.remove('gone');
      const sold=G.soulSold;
      const subs=['Your soul now belongs to the houseâ€¦','What remains of you lingers in the shadowsâ€¦','Even the scraps of your essence are oursâ€¦','There is nothing left to take.'];
      $$('goSub').textContent=subs[Math.min(sold,subs.length-1)];
      $$('goChips').textContent='Final chips: 0';
      const btn=$$('btnSellSoul');
      btn.style.display=sold<3?'':'none';
      if(sold>0) $$('goGhost').textContent='ğŸ’€';
    },3600);
  }
}

function showResult(ico,lbl,cls,delta){
  $$('rIco').textContent=ico;
  $$('rLbl').textContent=lbl;
  $$('rLbl').className='r-lbl '+cls;
  $$('rbox').className='rbox '+cls;
  const ce=$$('rChips');
  if(delta>0)      ce.innerHTML=`+${delta} chips &nbsp;Â·&nbsp; You have <span class="pos">${G.chips}</span>`;
  else if(delta<0) ce.innerHTML=`${delta} chips &nbsp;Â·&nbsp; You have <span class="neg">${G.chips}</span>`;
  else             ce.innerHTML=`Bet returned &nbsp;Â·&nbsp; You have <span class="pos">${G.chips}</span>`;
  $$('resultOverlay').classList.add('show');
}
function hideResult(){ $$('resultOverlay').classList.remove('show'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEXT ROUND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nextRound(){
  hideResult();
  G.round++; G.phase='bet';
  G.pH=[]; G.dH=[]; G.n1=[]; G.n2=[];
  G.split=null; G.sIdx=0;
  G.bet=Math.min(G.bet,G.chips);
  if(G.bet<10) G.bet=Math.min(10,G.chips);
  phase('bet'); updateUI();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SOUL SWAP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doSoulSwap(){
  sfxSwap();
  G.swapped=!G.swapped;
  $$('soulSub').textContent=G.swapped
    ?'You are now the DEALER. Hit â‰¤16, Stand â‰¥17.'
    :'Souls returned. You are yourself again.';
  $$('soulSwap').classList.add('on');
  setTimeout(()=>$$('soulSwap').classList.remove('on'),3200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PEEK / CHEAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function attemptPeek(){
  if(G.phase!=='player') return;
  Math.random()<.40 ? triggerCaught() : revealPeek();
}
function revealPeek(){
  const hole=G.dH.find(c=>c.hid);
  if(!hole) return;
  hole.hid=false; updateUI();
  const pb=$$('peekBubble');
  pb.innerHTML=`ğŸ‘ &nbsp;Hole card: <strong>${hole.v}${hole.s}</strong>`;
  pb.classList.add('show');
  setTimeout(()=>{ hole.hid=true; pb.classList.remove('show'); updateUI(); },3000);
}
function triggerCaught(){
  G.strikes++; sfxCaught();
  const spr=$$('dealerSpr');
  spr.classList.add('charging');
  setTimeout(()=>spr.classList.remove('charging'),780);
  showCrack();
  const pen=Math.floor(G.chips*.20);
  G.chips=Math.max(0,G.chips-pen); updateUI();
  if(G.strikes>=G.maxS){
    setTimeout(()=>{
      $$('crack').classList.remove('on');
      $$('gameScreen').classList.add('gone');
      $$('gameOverScreen').classList.remove('gone');
      $$('goChips').textContent='â˜ ï¸ Banned for cheating!';
      $$('goSub').textContent='The house does not forget.';
      $$('goGhost').textContent='ğŸ’€';
      $$('btnSellSoul').style.display=G.soulSold<3?'':'none';
    },2900);
  }
}
function showCrack(){
  $$('crack').classList.add('on');
  setTimeout(()=>$$('crack').classList.remove('on'),4200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NPC REACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const EMOTES=['ğŸ˜±','ğŸ¤”','ğŸ‘€','ğŸ˜…','ğŸ˜‚','ğŸ’€','ğŸ™€','ğŸ«£','ğŸ˜®','ğŸ¤­','ğŸ˜¬','ğŸ‘»'];
function npcReact(){
  ['npc1','npc2'].forEach(id=>{
    if(Math.random()<.55){
      const el=$$(id);
      el.querySelector('.npc-react')?.remove();
      const r=document.createElement('div');
      r.className='npc-react';
      r.textContent=EMOTES[0|Math.random()*EMOTES.length];
      el.appendChild(r);
      setTimeout(()=>r.remove(),1700);
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KEYBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('keydown',e=>{
  if(G.phase==='over'&&e.key==='Enter'){nextRound();return;}
  if(G.phase!=='player') return;
  switch(e.key.toLowerCase()){
    case 'h':playerHit();break;
    case 's':playerStand();break;
    case 'd':if(!$$('btnDouble').disabled)playerDouble();break;
    case 'x':if(!$$('btnSplit').disabled)playerSplit();break;
    case 'p':attemptPeek();break;
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SELL YOUR SOUL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SOUL_DEALS=[
  {chips:666, flavor:'The house accepts your soul. Spend these wisely â€” you won\'t get many more chances.',                warning:'First soul sold'},
  {chips:333, flavor:'A fragment remains. The dealer eyes what\'s left of you with quiet hunger.',                        warning:'Second soul sold'},
  {chips:100, flavor:'A mere sliver of essenceâ€¦ barely worth the paperwork. These are your last chips.',                  warning:'Final soul sold â€” no more deals'},
];
function sellSoul(){
  const idx=G.soulSold;
  if(idx>=SOUL_DEALS.length) return;
  const deal=SOUL_DEALS[idx];
  G.soulSold++;
  G.chips=deal.chips;
  G.bet=Math.min(50,G.chips);
  G.strikes=0;

  $$('sdFlavor').textContent=deal.flavor;
  $$('sdChips').textContent=`+${deal.chips} chips`;
  $$('sdWarning').textContent=deal.warning;

  $$('gameOverScreen').classList.add('gone');
  $$('soulDeal').classList.remove('gone');

  // Eerie soul-selling audio
  for(let i=0;i<12;i++) setTimeout(()=>tn(30+Math.random()*90,'sawtooth',.2,.38),i*65);
  [111,222,333,222,111].forEach((f,i)=>setTimeout(()=>tn(f,'sine',.28,.5),250+i*400));

  setTimeout(()=>{
    $$('soulDeal').classList.add('gone');
    $$('gameScreen').classList.remove('gone');
    $$('crack').classList.remove('on');
    hideResult();
    initPile();
    phase('bet'); updateUI();
  },3800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function resetGame(){
  Object.assign(G,{
    pile:[],chips:1000,bet:50,round:1,strikes:0,
    phase:'bet',swapped:false,swapIn:rand36(),
    ins:0,insTaken:false,
    pH:[],dH:[],n1:[],n2:[],split:null,sIdx:0,
    soulSold:0,
  });
  initPile();
  $$('gameOverScreen').classList.add('gone');
  $$('gameScreen').classList.remove('gone');
  $$('crack').classList.remove('on');
  hideResult();
  phase('bet'); updateUI();
}

initPile();
</script>
</body>
</html>
